<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2</title>
    <style>
        
        body, html
{
/* width: 100%;
height: 100%; */
padding: 0px;
margin: 0px;
overflow: hidden;
}

.wrapper
{ 
width: 100%;
height: 100%; 
}

.canvas
{display: block;
margin: 0px auto ;
margin-top: 20px;

/* width: 100%;
height: 100%;
background: #000;  */
}
#score
		{
		    position: absolute;
		    color: white;
		    background: black;
		    font-size: 25px;
		    top: 50px;
		    left: 50px;
		    z-index: 100;
		}


		body {
      padding: 20px;
      margin: 0;
      font-family: "Exo 2", sans-serif;
      box-sizing: border-box;
    }

    .title {
      font-size: 24px;
      text-align: center;
      padding: 1rem 0;
    }

    .mainmenu__list {
      padding: 0;
      margin: 0;
      list-style: none;
      border: 1px gray solid;
      display: flex;
    }

    .mainmenu li {
      list-style: none;
    }

    .mainmenu__link {
      display: block;
      padding: 10px 25px;
      color: #000;
      text-decoration: none;
    }

    .mainmenu__link:hover {
      text-decoration: none;
      background-color: darkgray;
      color: #fff;
    }

    .mainmenu__link.active {
      text-decoration: none;
      background-color: #000;
      color: #fff;
    }

    .content {
      padding: 1.5em 0;
    }


</style>
</head>
<body>

	<header class="title">Пример простейшей реализации SPA</header>

  <nav class="mainmenu" id="mainmenu">
    <ul class="mainmenu__list">
      <li><a class="mainmenu__link" href="#main">Главная</a></li>
      <li><a class="mainmenu__link" href="#about">О нас</a></li>
      <li><a class="mainmenu__link" href="#contacts">Контакты</a></li>
    </ul>
  </nav>

  <div class="content" id="content">
  </div>

    <!-- <div class="wrapper">
        <canvas width="0" height="0" class="canvas" id="canvas">Your browser does not support canvas.</canvas>
        <div id="score"></div>
    </div> -->
    
<script>

const contentContainer = document.getElementById("content");
    const menuContainer = document.getElementById("mainmenu");
    const menuLinks = menuContainer.querySelectorAll(".mainmenu__link");

    const links = {
      main: "<h1>Главная страница</h1><p>Здесь будет контент <strong>Главной</strong> страницы</p>",
      about: "<h1>О нас</h1><p>А здесь что-то как бы <strong>О нас</strong> или о них =)</p>",
      contacts: "<h1>Контакты</h1><p>Ну а тут классически будет страница <strong>Контакты</strong></p>",
    };

    function updateButtons() {
      const state = location.hash;

      for (let link of menuLinks) {
       state === link.getAttribute("href") ? link.classList.add("active") : link.classList.remove("active");
      }
    };

    function updateState() {
      let content = links[location.hash.slice(1)];

      contentContainer.innerHTML = content ? content : "<p>Страница не найдена</p>";
      updateButtons();
    }

    window.addEventListener("hashchange", updateState);

    window.addEventListener("load", (e) => {
      location.hash.slice(1) ? updateState() : location.hash = "#main";
    });



// const canvas = document.getElementById("canvas");
// const ctx = canvas.getContext("2d");
// canvas.width = 1000;
// canvas.height = 800;
// var speed = 5;





// class Road {
// 	constructor(image, y){
// 		this.x = 0;
// 		this.y = y;
// 		this.loaded = false;

// 		this.image = new Image();
		
// 		var obj = this;

// 		this.image.addEventListener("load", function () { obj.loaded = true; });

// 		this.image.src = image;
// 	}

// 	Update(road) {
// 		this.y += speed; //The image will move down with every frame

// 		if(this.y > canvas.height) //if the image left the screen, it will change it's position
// 		{
// 			this.y = road.y - canvas.width + speed; //New position depends on the second Road object
// 		}
// 	}
// }

// var roads = [
// 	new Road("img/roadLines.png", 0),
// 	new Road("img/roadLines.png", canvas.width)
// ]; //Backgrounds

// class Car{
// 	constructor(image, x, y, isPlayer){
// 		this.x = x;
// 		this.y = y;
// 		this.loaded = false;
// 		this.dead = false;
// 		this.isPlayer = isPlayer;
// 		this.okLeft === false;
// 		this.okRight === false;
// 		this.okUp === false;
// 		this.okDown === false;

// 		this.image = new Image();

// 		var obj = this;

// 		this.image.addEventListener("load", function () { obj.loaded = true; });

// 		this.image.src = image;
// 	}

// 	Update(){
// 		if(!this.isPlayer)
// 		{
// 			this.y += speed;
// 		}

// 		if(this.y > canvas.height + 50)
// 		{
// 			this.dead = true;
// 		}
// 		// if(this.okLeft === true && this.x + this.image.width > canvas.width){
// 		// 	this.x -= speed; 
// 		// }
// 		// if(this.okRight === true && this.x < 0){
// 		// 	this.x += speed; 
// 		// }

// 	}

// 	Collide(car){
// 		var hit = false;

// 		if(this.y < car.y + car.image.height && this.y + this.image.height > car.y) //If there is collision by y
// 		{
// 			if(this.x + this.image.width > car.x && this.x < car.x + car.image.width) //If there is collision by x
// 			{
// 				hit = true;
// 			}
// 		}

// 		return hit;
// 	}

// 	Move(v, d) {
// 		if(v == "x") {//Moving on x
// 			d *= 2;

// 			this.x += d; //Changing position

// 			//Rolling back the changes if the car left the screen
// 			if(this.x + this.image.width > canvas.width)
// 			{
// 				this.x -= d; 
// 			}
	
// 			if(this.x < 0)
// 			{
// 				this.x = 0;
// 			}
// 		}
// 		else {//Moving on y
// 			this.y += d;

// 			if(this.y + this.image.height > canvas.height)
// 			{
// 				this.y -= d;
// 			}

// 			if(this.y < 0)
// 			{
// 				this.y = 0;
// 			}
// 		}
// 	}
	

// }

// var player = new Car("img/car.png", canvas.width / 2, canvas.height / 2, true); //Player's object


// function Update() {
// 	roads[0].Update(roads[1]);
// 	roads[1].Update(roads[0]);

// 	player.Update();


	

// 	Draw();
// }

// function Draw() //Working with graphics
// {
// 	ctx.clearRect(0, 0, canvas.width, canvas.height); //Clearing the canvas

// 	for(var i = 0; i < roads.length; i++)
// 	{
// 		ctx.drawImage(
// 			roads[i].image, //Image
// 			0, //First X on image
// 			0, //First Y on image
// 			roads[i].image.width, //End X on image
// 			roads[i].image.height, //End Y on image
// 			roads[i].x, //X on canvas
// 			roads[i].y, //Y on canvas
// 			canvas.width, //Width on canvas
// 			canvas.width //Height on canvas
// 		);
// 	}
//     DrawCar(player);
   
	
// }

// function DrawCar(car)
// {
// 	ctx.drawImage(
// 		car.image, 
// 		0, 
// 		0, 
// 		car.image.width, 
// 		car.image.height, 
// 		car.x, 
// 		car.y, 
// 		car.image.width, 
// 		car.image.height 
// 	);
// }

// function KeyDown(e)
// {
// 	switch(e.keyCode)
// 	{
// 		case 37: //Left
// 			player.Move("x", -speed);
// 			break;

// 		case 39: //Right
// 			player.Move("x", speed);
// 			break;

// 		case 38: //Up
// 			player.Move("y", -speed);
// 			break;

// 		case 40: //Down
// 			player.Move("y", speed);
// 			break;

// 		case 27: //Esc
// 			if(timer == null)
// 			{
// 				Start();
// 			}
// 			else
// 			{
// 				Stop();
// 			}
// 			break;
// 	}
// }

// function start(){
// 	Update()
//     update();
//     requestAnimationFrame(start)
    
// 	// timer = setInterval(Update, 1000 / 60); //Updating the game 60 times a second
	
	
// }
// function stop(){
//     cancelAnimationFrame(start)
// 	// clearInterval(timer); //Game stop
// 	// timer = null;
// }

// start();

// window.addEventListener("keydown", function (e) { KeyDown(e); }); //Listenning for keyboard events




const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = 1000;
canvas.height = 800;
// var speed = 5;



var keys = [];
addEventListener('keydown', function(e) {
	keys[e.keyCode] = true;
});
addEventListener('keyup', function(e){
	keys[e.keyCode] = false;
});
var mycar = new Image();
var obs = new Image();
obs.src = 'img/car5.png';
var obs2 = new Image();
obs2.src = 'img/kamen.png';
var obs3 = new Image();
obs3.src = 'img/obs3.png';


let coinImage = new Image();
coinImage.src = 'img/coin-sprite-animation2.png';

var bg = new Image();
bg.src = 'img/roadLines.png';
mycar.src = 'img/mycar3.png';
var loadedImages = 0;
var myScore = 0.0;
var xinged = 0;
var life = 5;
let points = 0;
mycar.onload = function() {
	loadedImages++;
}
bg.onload = function() {
loadedImages++;
}
obs.onload = function() {
	loadedImages++;
	for(var i=0;i<carCount;i++)
		obstacles[i] = new Obstacles(i);
}
obs2.onload = function() {
	loadedImages++;
	for(var i=0;i<carCount2;i++)
		obstacles2[i] = new Obstacles2(i);
}


// for(var i=0;i<carCount3;i++){
//     obstacles3[i] = new Obstacles3(i);
// }
		

// coinImage.onload = function() {
// 	loadedImages++;
// 	for(var i=0;i<carCount3;i++){
// 	obstacles3[i] = new Obstacles3(i);
// }
// }


		

var carCount2 = 2;
var carCount3 = 3;
var carCount = 4;
var obsSpeed = 3;
function Obstacles(order) {
	this.order = order;
	this.x = (Math.random()*(canvas.width-100))+50;
	this.y = -250*this.order-300;
    this.width = 100;
    this.height = 200;
	this.draw = function() {
		this.y += obsSpeed;
		if(this.y >= canvas.height){
			xinged++;
			while(true) {
				this.x = (Math.random()*(canvas.width-100))+50;
				this.y = -400*Math.random()-300;
				var overlapping = false;
				for(var i=0;i<carCount ;i++){
					if(i!=this.order){
						if((Math.abs(obstacles[i].x-this.x)<100) && 
							(Math.abs(obstacles[i].y-this.y)<200)){
							overlapping = true;
							break;
						}
					}
				}
				if(overlapping == false){
					break;
				}
			}
		}
		ctx.drawImage(obs,this.x,this.y,100,200);
	}
}
function Obstacles2(order) {
	this.order = order;
	this.x = (Math.random()*(canvas.width-100))+50;
	this.y = -250*this.order-300;
    this.width = 55;
    this.height = 30;
	this.draw = function() {
		this.y += obsSpeed;
		if(this.y >= canvas.height){
			xinged++;
			while(true) {
				this.x = (Math.random()*(canvas.width-100))+50;
				this.y = -400*Math.random()-300;
				var overlapping = false;
				for(var i=0;i<carCount ;i++){
					if(i!=this.order){
						if((Math.abs(obstacles2[i].x - this.x)<110) && 
							(Math.abs(obstacles2[i].y - this.y)<55)){
							overlapping = true;
							break;
						}
					}
				}
				if(overlapping == false){
					break;
				}
			}
		}
        ctx.drawImage(obs2,this.x,this.y,55,30);
	}
}
// function Obstacles3(order) {

// 	this.order = order;
// 	this.x = (Math.random()*(canvas.width-100))+50;
// 	this.y = -250*this.order-300;
//     this.width = 100;
//     this.height = 200;
// 	this.draw = function() {
// 		this.y += obsSpeed;
// 		if(this.y >= canvas.height){
// 			xinged++;
// 			while(true) {
// 				this.x = (Math.random()*(canvas.width-100))+50;
// 				this.y = -400*Math.random()-300;
// 				var overlapping = false;
// 				for(var i=0;i<carCount ;i++){
// 					if(i!=this.order){
// 						if((Math.abs(obstacles3[i].x-this.x)<100) && 
// 							(Math.abs(obstacles3[i].y-this.y)<200)){
// 							overlapping = true;
// 							break;
// 						}
// 					}
// 				}
// 				if(overlapping == false){
// 					break;
// 				}
// 			}
// 		}
//         coinImage.classList.add('article');
//         ctx.drawImage(coinImage,this.x,this.y,100,200);
// 	}
// }


var obstacles = [];
var obstacles2 = [];
var obstacles3 = [];
// var allObstacles = [obstacles, obstacles2, obstacles3];

// const intersection = (...array) => array.reduce((a, b) => a.filter(v => b.includes(v)));
// function intersection(array1, array2, array3) {
//     let intermediateList = [];
//     let intermediateList2 = [];
//     for (let i = 0; i < array1.length; i++) {
//         if (array2.indexOf(array1[i]) !== -1) {
//             intermediateList.push(array1[i]);
//         }
//     }
//     for (let j = 0; j < intermediateList.length; j++) {
//         if (array3.indexOf(intermediateList[j]) !== -1) {
//             intermediateList2.push(intermediateList[j]);
//         }
//     }
//     return intermediateList2;
// }



class Sprite {
    constructor(order) {
        // this.ctx = options.ctx;
		this.order = order;
		this.image = coinImage;
		this.frameIndex = 0;
		this.tickCount = 0;
		this.ticksPerFrame = 4 || 0;
		this.numberOfFrames = 10 || 1;

		this.width = 1000;
		this.height = 100;
		this.x = (Math.random()*(canvas.width-100))+100;
		this.y = -250*this.order-300;


        
        // this.image = options.image;

        // this.frameIndex = 0;
        // this.tickCount = 0;
        // this.ticksPerFrame = options.ticksPerFrame || 0;
        // this.numberOfFrames = options.numberOfFrames || 1;

        // this.width = options.width;
        // this.height = options.height;
        // this.x = options.x;
        // this.y = options.y;

        // this.start();
    }

    update() {
        this.tickCount++;
		this.y += obsSpeed;
        if (this.tickCount > this.ticksPerFrame) {
            this.tickCount = 0;
            if (this.frameIndex < this.numberOfFrames - 1) {
                this.frameIndex++;
            } else {
                this.frameIndex = 0;
            }
        }
		if(this.y >= canvas.height){
			while(true) {
				this.x = (Math.random()*(canvas.width-100))+50;
				this.y = -400*Math.random()-300;
				var overlapping = false;
				for(var i=0;i<carCount ;i++){
					if(i!=this.order){
						if((Math.abs(obstacles[i].x-this.x)<100) && 
							(Math.abs(obstacles[i].y-this.y)<200)){
							overlapping = true;
							break;
						}
					}
				}
				if(overlapping == false){
					break;
				}
			}
		}
    }

    render() {
    // this.ctx.clearRect(0, 0, this.width / this.numberOfFrames, this.height);
        ctx.drawImage(
            this.image,
            this.frameIndex * this.width / this.numberOfFrames,
            0,
            this.width / this.numberOfFrames,
            this.height,
            this.x,
            this.y,
            this.width / this.numberOfFrames,
            this.height
        )
    }

    // start() {
    //     let loop = () => {
    //         this.update();
    //         this.render();

    //         window.requestAnimationFrame(loop);
    //     }

    //     window.requestAnimationFrame(loop);
    // }
}

// let canvas = document.getElementById('canvas');
// canvas.width = 100;
// canvas.height = 100;

// let coinImage = new Image();
// coinImage.src = 'img/coin-sprite-animation2.png';

for(var i=0;i<carCount3;i++){
    obstacles3[i] = new Sprite(i);
}

// let sprite1 = new Sprite({
// // ctx: canvas.getContext('2d'),
//   x: (Math.random()*(canvas.width-100))+100,
//   y: -250*1-300,
//   image: coinImage,
//   width: 1000,
//   height: 100,
//   numberOfFrames: 10,
//   ticksPerFrame: 4,
// })
// obstacles3.push(sprite1);
// let sprite2 = new Sprite({
// // ctx: canvas.getContext('2d'),
//   x: (Math.random()*(canvas.width-100))+100,
//   y: -250*1-300,
//   image: coinImage,
//   width: 1000,
//   height: 100,
//   numberOfFrames: 10,
//   ticksPerFrame: 4,
// })
// obstacles3.push(sprite2);
// let sprite3 = new Sprite({
// // ctx: canvas.getContext('2d'),
//   x: (Math.random()*(canvas.width-100))+100,
//   y: -250*1-300,
//   image: coinImage,
//   width: 1000,
//   height: 100,
//   numberOfFrames: 10,
//   ticksPerFrame: 4,
// })
// obstacles3.push(sprite3);


// function collision(objA, objB){
//     if ((objA.x + objA.width > objB.x) && (objA.x < objB.x + objB.width) && (objA.y + objA.height > objB.y) && (objA.y < objB.y + objB.height)){
//          return true;
//         }
//     else {return false;}
//     }

var bgy1=0;
var bgy2=-canvas.height;
var dbgy = 3;
var myCarX = canvas.width/2-50;
var myCarY = canvas.height/2-100;
function update() {
	if(loadedImages == 4){
		bgy1+=dbgy;
		bgy2+=dbgy;
		if(keys[37]){
			myCarX -= 4;
		}
		if(keys[39]){
			myCarX += 4;
		}
        if(keys[38]){
			myCarY -= 4;
		}
		if(keys[40]){
			myCarY += 4;
		}
		ctx.clearRect(0,0,canvas.width,canvas.height);

		myScore += 0.1;
		if(myScore > 100){
			dbgy = 4;
			obsSpeed = 4;
		}
        if(myScore > 200){
			dbgy = 6;
			obsSpeed = 6;
		}

		// document.getElementById('score').innerHTML = "Score: " 
		// 	+ parseInt(myScore) + '\n' + " Life: " 
		// 	+ parseInt(life) + '\n' + " Points: " + parseInt(points);

		if(bgy2 >= 0 ) {
			bgy1 = 0;
			bgy2 = -canvas.height;
		}
		ctx.drawImage(bg,0,bgy1,canvas.width,canvas.height);
		ctx.drawImage(bg,0,bgy2,canvas.width,canvas.height);
		ctx.drawImage(mycar,myCarX,myCarY,100,200);
        


        // for(var i=0;i<allObstacles.length;i++){
        //     let innerArrayLength = allObstacles[i].length;
            
        //     for(var j=0;i<innerArrayLength;j++){
        //         allObstacles[i]=obstacles[i]
        //         allObstacles[i][j].draw();
        //     }
			
		// }
        
		
		for(var i=0;i<carCount3;i++){
			obstacles3[i].render();
			obstacles3[i].update();
		}

		// if(obstacles.length <= 3){
		// 	sprite1.render();
        // sprite1.update();
		// sprite2.render();
        // sprite2.update();
		// sprite3.render();
        // sprite3.update();

		// }
	
        // sprite1.render();
        // sprite1.update();
		// sprite2.render();
        // sprite2.update();

   
        for(var i=0;i<carCount;i++){
			obstacles[i].draw();
		}
        for(var i=0;i<carCount2;i++){
			obstacles2[i].draw();
		}
        // for(var i=0;i<carCount3;i++){
		// 	obstacles3[i].draw();
		// }
      
    //     if(objects.length < 3) //Generating new car
	// {
	// 	objects.push(new Car("img/car_red.png", RandomInteger(30, canvas.width - 50), RandomInteger(250, 400) * -1 - 100, false));
	// }
		

		var overlapping = false;
		for(var i=0;i<carCount ;i++){
			if((obstacles[i].x + 90 > myCarX) && (obstacles[i].x < myCarX + 90) &&
				(obstacles[i].y + 190 > myCarY) && (obstacles[i].y < myCarY + 190)){
                obstacles[i].y = - 200;
				life -= 1;
				clickSound();
				break;
                
			}
		}
		for(var i=0;i<carCount3 ;i++){
			if((obstacles3[i].x + 90 > myCarX) && (obstacles3[i].x < myCarX + 90) &&
				(obstacles3[i].y + 190 > myCarY) && (obstacles3[i].y < myCarY + 190)){
                obstacles3[i].y = - 200;
				points += 1;
				carSound();
				break;
                
			}
		}
        if(life == 0){
			loadedImages = -1;
			cancelAnimationFrame(animate);
			alert("Stats:\n========\nDistance: " + parseInt(myScore)+
				"\nCars Avoided: "+xinged);
			
		}
        // for(var i=0;i<carCount2 ;i++){
		// 	if((obstacles2[i].x + 90 > myCarX) && (obstacles2[i].x < myCarX + 90) &&
		// 		(obstacles2[i].y + 190 > myCarY) && (obstacles2[i].y < myCarY + 190)){
		// 		overlapping = true;
		// 		break;
                
		// 	}
		// }
		if(overlapping == true){
			loadedImages = -1;
			cancelAnimationFrame(animate);
			alert("Stats:\n========\nDistance: " + parseInt(myScore)+
				"\nCars Avoided: "+xinged);
			
		}
	} 

}


var clickAudio=new Audio();
clickAudio.src = "audio/avtomobil-popal-v-avariyu (mp3cut.net).mp3";
function clickSound() {
        // clickAudio.currentTime=0; // в секундах
        clickAudio.play();
    }
var carAudio=new Audio;
carAudio.src = `audio/b0d98a-ec9b-4bc3-bc5 (mp3cut.net).mp3`;
function carSound() {
        // clickAudio.currentTime=0; // в секундах
        carAudio.play();
    }
var fonAudio=new Audio;
fonAudio.src = `audio/obgon-mnojestva-sopernikov-na-vyisokih-skorostyah.mp3`;
// function fonAllAudio(){
// 	fonAudio.play();
// }
// canvas.onload = function() {
// 	fonAudio.play();
// }

window.addEventListener('load', function() {
   
	fonAudio.play();
});


function drawLives(){
    ctx.font = "30px Arial"
    ctx.fillStyle = "white"
    ctx.fillText("Score: " + parseInt(myScore), 800, 50)
	ctx.fillText("Life: " + parseInt(life), 800, 80)
	ctx.fillText("Points: " + parseInt(points), 800, 110)
}

function animate() {
	requestAnimationFrame(animate);
	update();
	drawLives();
	// fonAllAudio();
}
animate();  

</script>    
</body>
</html>