<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V1</title>
    <style>
    canvas{
        display: block;
        margin: 0 auto;
    }
    </style>
</head>
<body>
 <canvas id="canvas"></canvas>
    
<script>

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = 500;
canvas.height = 500;

const road = new Image();
road.src = "img/road.png";
road.onload = function() {      
    const pattern = ctx.createPattern(road, "repeat");
    ctx.fillStyle = pattern;
    ctx.fillRect(0, 0, 500, 500);
    ctx.strokeRect(0, 0, 500, 500);
};



var lives = 5
var okLeft = false		
var okRight = false	
let stop2;
let crash;

var line = new Image()
line.src = "img/line.png"
line.X = 180
line.Y = -140

var line2 = new Image()
line2.src = "img/line.png"
line2.X = 180
line2.Y = 160

var myCar = new Image()
myCar.src = "img/myCar.png"
myCar.X = 50
myCar.Y = 400

var enemyCar1 = new Image()
enemyCar1.src = "img/enCar1.png"
enemyCar1.X = 50
enemyCar1.Y = -150

var enemyCar2 = new Image()
enemyCar2.src = "img/enCar2.png"
enemyCar2.X = 250
enemyCar2.Y = -450

// function drawLine1(){
//     ctx.fillStyle = "white"
//     ctx.fillRect(canvas.width / 2 - 10, 0, 20, 100)
// }

// function drawLine2(){
//     ctx.fillStyle = "white"
//     ctx.fillRect(canvas.width / 2 - 10, canvas.height / 2, 20, 120)
// }

// function drawLines(){
// 		ctx.drawImage(line, line.X, line.Y)
// 		line.Y +=3
// 		if (line.Y > 500){
// 			line.Y = -140
// 		}
		
// 		ctx.drawImage(line2, line2.X, line2.Y)
// 		line2.Y +=3
// 		if (line2.Y > 500){
// 			line2.Y = -140
// 		}
// }

function drawRect(){
    ctx.fillStyle = "gray"
    ctx.fillRect(0, 0, 400, 500)

}

function drawLives(){
    ctx.font = "30px Arial"
    ctx.fillStyle = "white"
    ctx.fillText("Lives: " + lives, 235, 48)
}

function drawLines(){
    ctx.drawImage(line, line.X, line.Y)
    line.Y += 3
    if(line.Y > 500){
        line.Y = -140
    }
    ctx.drawImage(line2, line2.X, line2.Y)
    line2.Y += 3
    if(line2.Y > 500){
        line2.Y = -140
    }
}

function stop(){
    cancelAnimationFrame(idReq)
    ctx.font = "60px Arial"
    ctx.fillStyle = "red"
    ctx.fillText("Game over", 40, 200)
    stop2 = true
}

function drawMyCar(){
    if(okLeft === true && myCar.X > 0){
        myCar.X -= 5
    }
    if(okRight === true && myCar.X < 335){
        myCar.X += 5
    }
    ctx.drawImage(myCar, myCar.X, myCar.Y)

}

function drawEnemyCar1(){
    if(enemyCar1.Y + 100 > myCar.Y && enemyCar1.X + 65 > myCar.X && enemyCar1.X < myCar.X + 65){
        crash = true
        enemyCar1.Y = enemyCar2.Y - 300
        lives --
        if(lives < 1){
            stop()
        }
    } else{
        crash = false
    }

    if(!crash){
        ctx.drawImage(enemyCar1, enemyCar1.X, enemyCar1.Y)
        enemyCar1.Y += 2
        if(enemyCar1.Y > 500){
            enemyCar1.Y = -100
            enemyCar1.X = Math.floor(Math.random() * 335) 
        }
    }
    
}

function drawEnemyCar2(){
    if(enemyCar2.Y + 100 > myCar.Y && enemyCar2.X + 65 > myCar.X && enemyCar2.X < myCar.X + 65){
        crash = true
        enemyCar2.Y = enemyCar1.Y - 300
        lives --
        if(lives < 1){
            stop()
        }
    } else{
        crash = false
    }

    if(!crash){
        ctx.drawImage(enemyCar2, enemyCar2.X, enemyCar2.Y)
        enemyCar2.Y += 2
        if(enemyCar2.Y > 500){
            enemyCar2.Y = -100
            enemyCar2.X = Math.floor(Math.random() * 335) 
        }
    }
    
}



function render(){
    if(stop2 === true){return}
    // drawLine1()
    // drawLine2()

    drawRect()
    drawLives()
    drawLines()
    drawMyCar()
    drawEnemyCar1()
    drawEnemyCar2()

    idReq = requestAnimationFrame(render)
}
render()

addEventListener("keydown", function(event){
    if(event.keyCode === 37){
        okLeft = true
    }
    if(event.keyCode === 39){
        okRight = true
    }
})
addEventListener("keyup", function(event){
    if(event.keyCode === 37){
        okLeft = false
    }
    if(event.keyCode === 39){
        okRight = false
    }
})

</script>


</body>
</html>