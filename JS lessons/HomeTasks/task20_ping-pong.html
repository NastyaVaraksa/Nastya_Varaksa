<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practical task №20 (ping-pong)</title>
</head>
<body>
  
<script>

let field;
let racket1;
let racket2;
let ball;
let startButton;
let count;
let countdown;
let myInterval;
let valueCountdown = "";
let timer; // пока пустая переменная


function createPingPong(){
    let wrapperDiv = document.createElement('div');
    wrapperDiv.style.cssText = 'width: 1000px; height: 800px; position: relative';
    wrapperDiv.setAttribute("id", "wrapperDiv");
    document.body.append(wrapperDiv);

    //поле
    let fieldObj = {
        "x": 0,
        "y": 150,
        "width": 800,
        "height": 400,
        "color": "yellow",
        "id": "field",
        "zIndex": "2",
        "borderWidth": 3,
        "borderColor": "black",
        "borderRadius": "0",
        "borderStyle": "solid"
    }
    field = new makeObj(fieldObj);
    field.createObj();
    //ракетки
    let racket1Obj = {
        "x" : 0,
        "y" :  0,
        "width" : 20,
        "height" : 150,
        "color" : "green",
        "id" : "racket1",
        "zIndex" : "3",
        "borderWidth" : "0",
        "borderColor" : "green",
        "borderRadius" : "0",
        "borderStyle" : "solid"
    }
    racket1 = new makeObj(racket1Obj);
    racket1.x = field.x + field.borderWidth;
    racket1.y = field.y + field.height/2 - racket1.height/2;
    racket1.createObj();

    let racket2Obj = {
        "x" : 0,
        "y" : 0,
        "width" : 20,
        "height" : 150,
        "color" : "blue",
        "id" : "racket2",
        "zIndex" : "3",
        "borderWidth" : "0",
        "borderColor" : "blue",
        "borderRadius" : "0",
        "borderStyle" : "solid"
    }
    racket2 = new makeObj(racket2Obj);
    racket2.x = field.x + field.width + field.borderWidth - racket2.width;
    racket2.y = field.y + field.height/2 - racket2.height/2;
    racket2.createObj();
    //начальные очки
    racket1.scores = 0;
    racket2.scores = 0;
    racket1.speedY = 0;
    racket2.speedY = 0;
    okTopRacket1 = false;
    okBottomRacket1 = false;
    okTopRacket2 = false;
    okBottomRacket2 = false;
    //мяч
    let ballObj = {
        "x" : 0,
        "y" : 0,
        "width" : 40,
        "height" : 40,
        "color" : "red",
        "id" : "ball",
        "zIndex" : "3",
        "borderWidth" : "0",
        "borderColor" : "red",
        "borderRadius" : "50%",
        "borderStyle" : "solid"
    }
    ball = new makeObj(ballObj);
    ball.x = field.x + field.width/2 - ball.width/2;
    ball.y = field.y + field.height/2 - ball.height/2;  
    ball.createObj();
    
    ball.speedX = 3;
    ball.speedY = 3;
   
    //кнопка старт
    let startButtonObj = {
        "x" : 20,
        "y" : 40,
        "width" : 80,
        "height" : 20,
        "color" : "grey",
        "id" : "startButton",
        "zIndex" : "3",
        "borderWidth" : "0",
        "borderColor" : "grey",
        "borderRadius" : "0",
        "borderStyle" : "solid"
    }
    startButton = new makeObj(startButtonObj);
    startButton.createObj();

    let textButt = document.getElementById("startButton");
    textButt.innerHTML = "СТАРТ!";
    textButt.style.cursor = 'pointer';
    textButt.style.color = 'black';
    textButt.style.fontSize = '25px';
    textButt.style.padding = '30px';

    //счёт
    let countObj = {
        "x" : 320,
        "y" : 30,
        "width" : 135,
        "height" : 110,
        "color" : "white",
        "id" : "count",
        "zIndex" : "3",
        "borderWidth" : "0",
        "borderColor" : "white",
        "borderRadius" : "0",
        "borderStyle" : "solid"
    }
    count = new makeObj(countObj);  
    count.createObj();

    let textCount = document.getElementById("count");
    textCount.innerHTML = racket1.scores + ":" + racket2.scores;
    textCount.style.color = 'black';
    textCount.style.fontSize = '100px';

    let countdownObj = {
        "x" : 350,
        "y" : 320,
        "width" : 200,
        "height" : 100,
        "color" : "",
        "id" : "countdown",
        "zIndex" : "0",
        "borderWidth" : "0",
        "borderColor" : "white",
        "borderRadius" : "0",
        "borderStyle" : "solid"
    }
    countdown = new makeObj(countdownObj);
    countdown.createObj();

    let textEnd = document.getElementById("countdown");
    textEnd.innerHTML = ``;
    textEnd.style.color = 'black';
    textEnd.style.fontSize = '50px';
    textEnd.style.zIndex = '10';
   
    window.addEventListener("keydown", moveRackets, false);
    window.addEventListener("keyup", stopRackets, false);
    textButt.addEventListener("click", start);
}


function makeObj(objA){    
    let self = this;
    self.x = objA.x;
    self.y = objA.y;
    self.width = objA.width;
    self.height = objA.height;
    self.color = objA.color;
    self.id = objA.id;
    self.zIndex = objA.zIndex;
    self.borderWidth = objA.borderWidth;
    self.borderColor = objA.borderColor;
    self.borderRadius = objA.borderRadius;
    self.borderStyle = objA.borderStyle;
    self.createObj = function(){
        let wrapperDiv = document.getElementById('wrapperDiv');
        let elem = document.createElement('div');
        elem.style.cssText = 'position: absolute; left:' + self.x + 'px; top:' + self.y + 'px; width:' + self.width + 'px; height:' + self.height + 'px; background-color:' +  self.color + '; z-index:' + self.zIndex + '; border-width:' + self.borderWidth + 'px ; border-radius:' + self.borderRadius + '; border-color:' + self.borderColor + '; border-style:' + self.borderStyle;
        elem.setAttribute('id', self.id);
        wrapperDiv.appendChild(elem);
    }
    self.showObj = function(){
        let obj = document.getElementById(this.id);
        obj.style.top = (this.y + 'px');
        obj.style.left = (this.x + 'px');
    }
}

function play(){
    draw();
    updateBall();
    updateRacket();
}

function draw(){
    ball.showObj();
    racket2.showObj();
    racket1.showObj();
    let scoresShow = document.getElementById("count");
    scoresShow.innerHTML = racket1.scores + ":" + racket2.scores;

    if(racket1.stopInterval || racket2.stopInterval){
        clearInterval(myInterval);
    }
}

function updateBall(){
    ball.x += ball.speedX;
    ball.y += ball.speedY;
    //соприкосновение с горизонтальными стенками
        if (ball.y < field.y + field.borderWidth || ball.y + ball.height>field.y + field.height + field.borderWidth){
        ball.speedY = -ball.speedY;
        
        }
        //соприкосновение с левой стенкой
        if(ball.x<field.borderWidth){
        ball.x = field.borderWidth   
        ball.speedX = -ball.speedX;
        racket2.scores ++;
        racket2.stopInterval = true;
        setTimeout(start, 3000);
        valueCountdown = 3; // стартовое значение обратного отсчета
        countdownF(); // вызов функции
        }
        //соприкосновение с правой стенкой
        if(ball.x + ball.width>field.x + field.width + field.borderWidth){
        ball.x = field.x + field.width + field.borderWidth - ball.width;
        ball.speedX = -ball.speedX;
        racket1.scores ++;
        racket1.stopInterval = true;
        setTimeout(start, 3000);
        valueCountdown = 3;
        countdownF(); // вызов функции
        }
        //столкновение с ракетками
        if(collision(racket1, ball)&&ball.speedX<0){
            ball.speedX = -ball.speedX;
            ball.speedX += 2;
        }
        if(collision(racket2, ball)&&ball.speedX>0){
            ball.speedX += 2;
            ball.speedX = -ball.speedX;
        }
}

    function collision(objA, objB){
    if ((objA.x + objA.width > objB.x) && (objA.x < objB.x + objB.width) && (objA.y + objA.height > objB.y) && (objA.y < objB.y + objB.height)){
         return true;
        }
    else {return false;}

    
}

function updateRacket() {
    if(okBottomRacket1 === true && racket1.y < field.y + field.height + field.borderWidth - racket1.height){
        racket1.speedY = 5;  
        racket1.y += racket1.speedY;     
        };
    if(okBottomRacket2 === true && racket2.y < field.y + field.height + field.borderWidth - racket2.height){
        racket2.speedY = 5;  
        racket2.y += racket2.speedY;			    		
        };
    if(okTopRacket1 === true && racket1.y > field.y + field.borderWidth){
        racket1.speedY = -5;  
        racket1.y += racket1.speedY;
        };
    if(okTopRacket2 === true && racket2.y > field.y + field.borderWidth){
        racket2.speedY = -5;  
        racket2.y += racket2.speedY;
        };
    if( racket1.scores===2 || racket2.scores===2){
        racket1.stopInterval = true;
        racket2.stopInterval = true;
        document.getElementById('countdown').innerHTML =  `Game over`;
    }
}

function countdownF(){  // функция обратного отсчета
        document.getElementById('countdown').innerHTML = valueCountdown;
        valueCountdown--; // уменьшаем число на единицу
        if (racket1.scores === 2 || racket2.scores === 2){
             document.getElementById('countdown').innerHTML = "";
        } else if (valueCountdown < 0){
            document.getElementById('countdown').innerHTML = "";
            clearTimeout(timer); // таймер остановится на нуле
        }
        else {
            timer = setTimeout(countdownF, 1000);
        }
}
        

function start(){
    racket1.y = field.y + field.height/2 - racket1.height/2;
    racket2.y = field.y + field.height/2 - racket2.height/2;
    racket1.scores;
    racket2.scores;
    moveBall();

    racket1.stopInterval = false;
    racket2.stopInterval = false;
    myInterval = setInterval(play, 25);
}

function moveBall(){
    let min = 1;
    let max = 4;
    ball.x = field.x + field.width/2 - ball.width/2;;
    ball.y = field.y + field.height/2 - ball.height/2;
    
    let rand = Math.round(min - 0.5 + Math.random() * (max - min + 1));

    if ( rand == 1) 
    {ball.speedX = -2;
        ball.speedY = 2;
    }
    if ( rand == 2) 
    {ball.speedX = -2;
        ball.speedY = -2;
    }
    if ( rand == 3) 
    {ball.speedX = 2;
        ball.speedY = -2;
    }
    if ( rand == 4) 
    {ball.speedX = 2;
        ball.speedY = 2;
    }

}

function moveRackets(event){
    switch (event.keyCode) {
        case 17:
        okBottomRacket1 = true;
        break;
        case 40:
        okBottomRacket2 = true;
        break;
        case 16: 
        okTopRacket1 = true;
        break;
        case 38: 
        okTopRacket2 = true;
        break;  
    }
}

function stopRackets(event){
    switch (event.keyCode) {
        case 17:
        okBottomRacket1 = false;
        break;
        case 40:
        okBottomRacket2 = false;
        break;
        case 16: 
        okTopRacket1 = false;
        break;
        case 38: 
        okTopRacket2 = false;
        break;  
    }
}  

createPingPong();

</script>    


</body>
</html>